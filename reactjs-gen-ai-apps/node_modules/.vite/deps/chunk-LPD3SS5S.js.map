{
  "version": 3,
  "sources": ["../../langchain/dist/chains/base.js"],
  "sourcesContent": ["import { RUN_KEY } from \"@langchain/core/outputs\";\nimport { CallbackManager, parseCallbackConfigArg, } from \"@langchain/core/callbacks/manager\";\nimport { BaseLangChain, } from \"@langchain/core/language_models/base\";\n/**\n * Base interface that all chains must implement.\n */\nexport class BaseChain extends BaseLangChain {\n    get lc_namespace() {\n        return [\"langchain\", \"chains\", this._chainType()];\n    }\n    constructor(fields, \n    /** @deprecated */\n    verbose, \n    /** @deprecated */\n    callbacks) {\n        if (arguments.length === 1 &&\n            typeof fields === \"object\" &&\n            !(\"saveContext\" in fields)) {\n            // fields is not a BaseMemory\n            const { memory, callbackManager, ...rest } = fields;\n            super({ ...rest, callbacks: callbackManager ?? rest.callbacks });\n            this.memory = memory;\n        }\n        else {\n            // fields is a BaseMemory\n            super({ verbose, callbacks });\n            this.memory = fields;\n        }\n    }\n    /** @ignore */\n    _selectMemoryInputs(values) {\n        const valuesForMemory = { ...values };\n        if (\"signal\" in valuesForMemory) {\n            delete valuesForMemory.signal;\n        }\n        if (\"timeout\" in valuesForMemory) {\n            delete valuesForMemory.timeout;\n        }\n        return valuesForMemory;\n    }\n    /**\n     * Invoke the chain with the provided input and returns the output.\n     * @param input Input values for the chain run.\n     * @param config Optional configuration for the Runnable.\n     * @returns Promise that resolves with the output of the chain run.\n     */\n    async invoke(input, config) {\n        const fullValues = await this._formatValues(input);\n        const callbackManager_ = await CallbackManager.configure(config?.callbacks, this.callbacks, config?.tags, this.tags, config?.metadata, this.metadata, { verbose: this.verbose });\n        const runManager = await callbackManager_?.handleChainStart(this.toJSON(), fullValues, undefined, undefined, undefined, undefined, config?.runName);\n        let outputValues;\n        try {\n            outputValues = await (fullValues.signal\n                ? Promise.race([\n                    this._call(fullValues, runManager),\n                    new Promise((_, reject) => {\n                        fullValues.signal?.addEventListener(\"abort\", () => {\n                            reject(new Error(\"AbortError\"));\n                        });\n                    }),\n                ])\n                : this._call(fullValues, runManager));\n        }\n        catch (e) {\n            await runManager?.handleChainError(e);\n            throw e;\n        }\n        if (!(this.memory == null)) {\n            await this.memory.saveContext(this._selectMemoryInputs(input), outputValues);\n        }\n        await runManager?.handleChainEnd(outputValues);\n        // add the runManager's currentRunId to the outputValues\n        Object.defineProperty(outputValues, RUN_KEY, {\n            value: runManager ? { runId: runManager?.runId } : undefined,\n            configurable: true,\n        });\n        return outputValues;\n    }\n    _validateOutputs(outputs) {\n        const missingKeys = this.outputKeys.filter((k) => !(k in outputs));\n        if (missingKeys.length) {\n            throw new Error(`Missing output keys: ${missingKeys.join(\", \")} from chain ${this._chainType()}`);\n        }\n    }\n    async prepOutputs(inputs, outputs, returnOnlyOutputs = false) {\n        this._validateOutputs(outputs);\n        if (this.memory) {\n            await this.memory.saveContext(inputs, outputs);\n        }\n        if (returnOnlyOutputs) {\n            return outputs;\n        }\n        return { ...inputs, ...outputs };\n    }\n    /**\n     * Return a json-like object representing this chain.\n     */\n    serialize() {\n        throw new Error(\"Method not implemented.\");\n    }\n    /** @deprecated Use .invoke() instead. Will be removed in 0.2.0. */\n    async run(\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    input, config) {\n        const inputKeys = this.inputKeys.filter((k) => !this.memory?.memoryKeys.includes(k) ?? true);\n        const isKeylessInput = inputKeys.length <= 1;\n        if (!isKeylessInput) {\n            throw new Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const values = inputKeys.length ? { [inputKeys[0]]: input } : {};\n        const returnValues = await this.call(values, config);\n        const keys = Object.keys(returnValues);\n        if (keys.length === 1) {\n            return returnValues[keys[0]];\n        }\n        throw new Error(\"return values have multiple keys, `run` only supported when one key currently\");\n    }\n    async _formatValues(values) {\n        const fullValues = { ...values };\n        if (fullValues.timeout && !fullValues.signal) {\n            fullValues.signal = AbortSignal.timeout(fullValues.timeout);\n            delete fullValues.timeout;\n        }\n        if (!(this.memory == null)) {\n            const newValues = await this.memory.loadMemoryVariables(this._selectMemoryInputs(values));\n            for (const [key, value] of Object.entries(newValues)) {\n                fullValues[key] = value;\n            }\n        }\n        return fullValues;\n    }\n    /**\n     * @deprecated Use .invoke() instead. Will be removed in 0.2.0.\n     *\n     * Run the core logic of this chain and add to output if desired.\n     *\n     * Wraps _call and handles memory.\n     */\n    async call(values, config, \n    /** @deprecated */\n    tags) {\n        const parsedConfig = { tags, ...parseCallbackConfigArg(config) };\n        return this.invoke(values, parsedConfig);\n    }\n    /**\n     * @deprecated Use .batch() instead. Will be removed in 0.2.0.\n     *\n     * Call the chain on all inputs in the list\n     */\n    async apply(inputs, config) {\n        return Promise.all(inputs.map(async (i, idx) => this.call(i, config?.[idx])));\n    }\n    /**\n     * Load a chain from a json-like object describing it.\n     */\n    static async deserialize(data, values = {}) {\n        switch (data._type) {\n            case \"llm_chain\": {\n                const { LLMChain } = await import(\"./llm_chain.js\");\n                return LLMChain.deserialize(data);\n            }\n            case \"sequential_chain\": {\n                const { SequentialChain } = await import(\"./sequential_chain.js\");\n                return SequentialChain.deserialize(data);\n            }\n            case \"simple_sequential_chain\": {\n                const { SimpleSequentialChain } = await import(\"./sequential_chain.js\");\n                return SimpleSequentialChain.deserialize(data);\n            }\n            case \"stuff_documents_chain\": {\n                const { StuffDocumentsChain } = await import(\"./combine_docs_chain.js\");\n                return StuffDocumentsChain.deserialize(data);\n            }\n            case \"map_reduce_documents_chain\": {\n                const { MapReduceDocumentsChain } = await import(\"./combine_docs_chain.js\");\n                return MapReduceDocumentsChain.deserialize(data);\n            }\n            case \"refine_documents_chain\": {\n                const { RefineDocumentsChain } = await import(\"./combine_docs_chain.js\");\n                return RefineDocumentsChain.deserialize(data);\n            }\n            case \"vector_db_qa\": {\n                const { VectorDBQAChain } = await import(\"./vector_db_qa.js\");\n                return VectorDBQAChain.deserialize(data, values);\n            }\n            case \"api_chain\": {\n                const { APIChain } = await import(\"./api/api_chain.js\");\n                return APIChain.deserialize(data);\n            }\n            default:\n                throw new Error(`Invalid prompt type in config: ${data._type}`);\n        }\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
